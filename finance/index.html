<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Finance Dashboard</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        /* CSS is kept consistent with your excellent design */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Exo 2', sans-serif;
            background: #0a0a0a;
            color: white;
            overflow-x: hidden;
        }

        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            z-index: -1;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            overflow: hidden;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 5px rgba(78, 205, 196, 0.5);
            animation: slow-move 20s linear infinite;
        }
        
        @keyframes slow-move {
            0% { transform: translate(0, 0); opacity: 0.5; }
            50% { transform: translate(100px, 50px); opacity: 1; }
            100% { transform: translate(0, 0); opacity: 0.5; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 4rem;
            font-weight: 900;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { filter: drop-shadow(0 0 20px rgba(255, 107, 107, 0.5)); }
            to { filter: drop-shadow(0 0 30px rgba(78, 205, 196, 0.8)); }
        }

        .header p {
            font-size: 1.2rem;
            color: #ccc;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .stat-card, .card {
            background: rgba(15, 17, 30, 0.7);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 30px;
            transition: all 0.3s ease;
            position: relative;
            border: 1px solid transparent;
            background-clip: padding-box;
            border-image: linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(255, 107, 107, 0.2)) 1;
        }

        .stat-card:hover, .card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 0 40px rgba(78, 205, 196, 0.3), 0 0 20px rgba(255, 107, 107, 0.2);
            border-image: linear-gradient(135deg, rgba(78, 205, 196, 1), rgba(255, 107, 107, 1)) 1;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card h3 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
            font-family: 'Exo 2', sans-serif;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #4ecdc4;
            box-shadow: 0 0 20px rgba(78, 205, 196, 0.3);
        }

        .form-group input::placeholder {
            color: #ccc;
        }
        
        .form-group select option {
            background: #1a1a2e;
            color: white;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border: none;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Exo 2', sans-serif;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
        }

        .expense-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
        }

        .expense-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateX(5px);
        }

        .delete-btn {
            border: none;
            border-radius: 10px;
            color: white;
            padding: 5px 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 5px;
        }
        
        .delete-btn[onclick*="deleteExpense"] {
             background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }
        
        .delete-btn[onclick*="startEditExpense"] {
             background: linear-gradient(45deg, #4ecdc4, #45b7d1);
        }

        .delete-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .insight-item {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid #4ecdc4;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .category-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .category-item:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.02);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.8s ease;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4);
        }

        .footer {
            text-align: center;
            padding: 40px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 40px;
        }

        .footer span {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: bold;
            font-size: 1.2rem;
            animation: rainbow 3s ease-in-out infinite alternate;
        }

        @keyframes rainbow {
            0%, 100% { filter: hue-rotate(0deg); }
            50% { filter: hue-rotate(180deg); }
        }

        .social-section {
            margin: 60px 0;
            padding: 40px;
            background: rgba(15, 17, 30, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid transparent;
            background-clip: padding-box;
            border-image: linear-gradient(135deg, rgba(78, 205, 196, 0.1), rgba(255, 107, 107, 0.1)) 1;
            border-radius: 30px;
        }

        .social-links {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .social-card {
            display: flex;
            align-items: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            text-decoration: none;
            color: white;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .social-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .social-card:hover::before {
            left: 100%;
        }

        .social-card:hover {
            transform: translateY(-5px) scale(1.02);
        }

        .social-card.instagram:hover {
            box-shadow: 0 15px 35px rgba(225, 48, 108, 0.4);
            border-color: #e1306c;
        }

        .social-card.twitter:hover {
            box-shadow: 0 15px 35px rgba(29, 161, 242, 0.4);
            border-color: #1da1f2;
        }

        .social-card.email:hover {
            box-shadow: 0 15px 35px rgba(234, 67, 53, 0.4);
            border-color: #ea4335;
        }

        .social-icon {
            font-size: 2.5rem;
            margin-right: 20px;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .social-info h4 {
            margin: 0;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .social-info p {
            margin: 5px 0 0 0;
            color: #ccc;
            font-size: 0.9rem;
        }

        .data-management {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .data-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 15px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Exo 2', sans-serif;
        }

        .export-btn {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }

        .import-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
        }

        .clear-btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .data-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .file-input {
            display: none;
        }

        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            margin-right: 10px;
        }

        .expense-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .expense-list::-webkit-scrollbar {
            width: 8px;
        }

        .expense-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .expense-list::-webkit-scrollbar-thumb {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            border-radius: 10px;
        }

        @media (max-width: 768px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="container">
        <div class="header">
            <h1>üè¶ AI Finance Dashboard</h1>
            <p>Smart expense tracking with AI insights</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>üí∞ Total Expenses</h3>
                <p id="total-expenses" style="font-size: 2.5rem; font-weight: bold;">‚Çπ0</p>
            </div>
            <div class="stat-card">
                <h3>üìä Total Transactions</h3>
                <p id="total-transactions" style="font-size: 2.5rem; font-weight: bold;">0</p>
            </div>
            <div class="stat-card">
                <h3>üéØ Active Categories</h3>
                <p id="active-categories" style="font-size: 2.5rem; font-weight: bold;">0</p>
            </div>
        </div>

        <div class="main-grid">
            <div class="card">
                <h3>‚ûï Add New Expense</h3>
                <form id="expense-form">
                    <div class="form-group">
                        <input type="number" id="amount" placeholder="Amount (‚Çπ)" required>
                    </div>
                    <div class="form-group">
                        <select id="category" required>
                            <option value="food">üçΩÔ∏è Food</option>
                            <option value="travel">üöó Travel</option>
                            <option value="rent">üè† Rent</option>
                            <option value="household">üß∫ Household/Groceries</option>
                            <option value="shopping">üõçÔ∏è Shopping</option>
                            <option value="entertainment">üé¨ Entertainment</option>
                            <option value="health">üè• Health</option>
                            <option value="emi">üí≥ Loan/EMI</option>
                            <option value="sip">üìà SIP/Investment</option>
                            <option value="education">üìö Education Fee</option>
                            <option value="dues">üîî Dues/Bills</option>
                            <option value="maintenance">üõ†Ô∏è Maintenance</option>
                            <option value="other">‚ùì Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="text" id="description" placeholder="Description" required>
                    </div>
                    <div class="form-group">
                        <input type="date" id="date" required>
                    </div>
                    <button type="submit" class="btn">Add Expense</button>
                </form>

                <div class="data-management">
                    <button class="data-btn export-btn" onclick="exportData()">
                        üíæ Export Data
                    </button>
                    <label for="import-file" class="data-btn import-btn">
                        üìÅ Import Data
                    </label>
                    <input type="file" id="import-file" class="file-input" accept=".json" onchange="importData(event)">
                    <button class="data-btn clear-btn" onclick="clearAllData()">
                        üóëÔ∏è Clear All
                    </button>
                </div>
                
                <h3 style="margin-top: 30px;">üéØ Monthly Budget Settings</h3>
                <form id="budget-form">
                    <div class="form-group">
                        <select id="budget-category" required>
                            <option value="total">Overall Monthly Budget</option>
                            <option value="food">üçΩÔ∏è Food</option>
                            <option value="travel">üöó Travel</option>
                            <option value="rent">üè† Rent</option>
                            <option value="household">üß∫ Household/Groceries</option>
                            <option value="shopping">üõçÔ∏è Shopping</option>
                            <option value="entertainment">üé¨ Entertainment</option>
                            <option value="health">üè• Health</option>
                            <option value="emi">üí≥ Loan/EMI</option>
                            <option value="sip">üìà SIP/Investment</option>
                            <option value="education">üìö Education Fee</option>
                            <option value="dues">üîî Dues/Bills</option>
                            <option value="maintenance">üõ†Ô∏è Maintenance</option>
                            <option value="other">‚ùì Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <input type="number" id="budget-amount" placeholder="Set Budget Amount (‚Çπ)" required>
                    </div>
                    <button type="submit" class="btn" style="background: linear-gradient(45deg, #667eea, #764ba2);">Set Budget</button>
                </form>


                <h3 style="margin-top: 30px;">üìã Recent Transactions</h3>
                <div id="recent-transactions" class="expense-list">
                    </div>
            </div>

            <div class="card">
                <h3>üìä Expense Analytics</h3>
                
                <div class="chart-container">
                    <canvas id="pie-chart"></canvas>
                </div>

                <div class="chart-container">
                    <canvas id="line-chart"></canvas>
                </div>
            </div>

            <div class="card">
                <h3>ü§ñ AI Insights & Reports</h3>
                <div id="ai-insights">
                    <div class="insight-item">
                        <p style="color: #4ecdc4;">Start adding expenses and set budgets to get AI insights! üöÄ</p>
                    </div>
                </div>

                <h3 style="margin-top: 30px;">üìã Categories</h3>
                <div id="categories-overview">
                    </div>
            </div>
        </div>

        <div class="social-section">
            <h3 style="text-align: center; margin-bottom: 30px; font-size: 2rem;">Connect with me ü§ù</h3>
            <div class="social-links">
                <a href="https://instagram.com/priyansh__.86/" target="_blank" class="social-card instagram">
                    <div class="social-icon">üì∑</div>
                    <div class="social-info">
                        <h4>Instagram</h4>
                        <p>@priyansh__.86</p>
                    </div>
                </a>
                <a href="https://x.com/priyansh_86/" target="_blank" class="social-card twitter">
                    <div class="social-icon">üê¶</div>
                    <div class="social-info">
                        <h4>Twitter/X</h4>
                        <p>@priyansh_86</p>
                    </div>
                </a>
                <a href="mailto:priyanshrajbhar499@gmail.com" class="social-card email">
                    <div class="social-icon">‚úâÔ∏è</div>
                    <div class="social-info">
                        <h4>Email</h4>
                        <p>priyanshrajbhar499@gmail.com</p>
                    </div>
                </a>
            </div>
        </div>

        <div class="footer">
            <p>Made with ‚ù§Ô∏è by <span>Priyansh</span></p>
        </div>
    </div>

    <script>
        // Global Data & Setup
        let expenses = []; 
        let budgets = {}; 
        let isEditing = false; 
        let expenseToEditId = null; 

        // UPDATED CATEGORIES LIST
        const categories = {
            food: { name: 'Food', icon: 'üçΩÔ∏è', color: '#FF6B6B' },
            travel: { name: 'Travel', icon: 'üöó', color: '#4ECDC4' },
            rent: { name: 'Rent', icon: 'üè†', color: '#96CEB4' },
            household: { name: 'Household', icon: 'üß∫', color: '#6A5ACD' }, // NEW
            shopping: { name: 'Shopping', icon: 'üõçÔ∏è', color: '#45B7D1' },
            entertainment: { name: 'Entertainment', icon: 'üé¨', color: '#FFEAA7' },
            health: { name: 'Health', icon: 'üè•', color: '#DDA0DD' },
            emi: { name: 'Loan/EMI', icon: 'üí≥', color: '#FF7F50' }, // NEW
            sip: { name: 'SIP/Investment', icon: 'üìà', color: '#3CB371' }, // NEW
            education: { name: 'Education Fee', icon: 'üìö', color: '#DA70D6' }, // NEW
            dues: { name: 'Dues/Bills', icon: 'üîî', color: '#00CED1' }, // NEW
            maintenance: { name: 'Maintenance', icon: 'üõ†Ô∏è', color: '#BDB76B' }, // NEW
            other: { name: 'Other', icon: '‚ùì', color: '#778899' } // NEW
        };

        let pieChart, lineChart;

        document.addEventListener('DOMContentLoaded', function() {
            // WHY: Ensures all setup runs after the page loads.
            createMinimalParticles(); // Lightweight background
            setTodayDate();
            initCharts();
            loadData();
            updateDashboard();
            
            document.getElementById('expense-form').addEventListener('submit', handleExpenseSubmission);
            document.getElementById('budget-form').addEventListener('submit', setBudget);
        });

        // ----------------------------------------------------------------------
        // Background Function (Minimalist Particles)
        // ----------------------------------------------------------------------

        function createMinimalParticles() {
            // WHY: Provides a smooth, lag-free visual background using minimal native JS/CSS.
            const container = document.getElementById('canvas-container');
            const particleCount = 100;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * window.innerHeight;
                const size = Math.random() * 2 + 1;
                const duration = Math.random() * 15 + 15;
                
                particle.style.left = `${x}px`;
                particle.style.top = `${y}px`;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `-${Math.random() * duration}s`; 
                
                container.appendChild(particle);
            }
        }


        // ----------------------------------------------------------------------
        // LocalStorage Functions
        // ----------------------------------------------------------------------

        function saveData() {
            // WHY: To save expenses and budgets persistently.
            try {
                localStorage.setItem('financeData', JSON.stringify(expenses));
                localStorage.setItem('budgetData', JSON.stringify(budgets)); 
            } catch (e) {
                console.error('LocalStorage error:', e);
            }
        }

        function loadData() {
            // WHY: To retrieve saved data on page load.
            try {
                const savedExpenseData = localStorage.getItem('financeData');
                if (savedExpenseData) {
                    expenses = JSON.parse(savedExpenseData);
                }

                const savedBudgetData = localStorage.getItem('budgetData');
                if (savedBudgetData) {
                    budgets = JSON.parse(savedBudgetData); 
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        function clearAllData() {
            // WHY: Provides a hard reset option.
            if (confirm('üóëÔ∏è Are you sure you want to clear ALL data? This includes expenses AND budgets!')) {
                expenses = [];
                budgets = {};
                saveData();
                updateDashboard();
                alert('‚úÖ All data cleared successfully!');
            }
        }

        // ----------------------------------------------------------------------
        // Expense Handling (Add/Edit Logic)
        // ----------------------------------------------------------------------

        function handleExpenseSubmission(e) {
            // WHY: Handles both new expense creation and editing existing ones.
            e.preventDefault();
            
            const amount = parseFloat(document.getElementById('amount').value);
            const category = document.getElementById('category').value;
            const description = document.getElementById('description').value;
            const date = document.getElementById('date').value;

            if (isEditing) {
                updateExpense(expenseToEditId, amount, category, description, date);
            } else {
                addExpense(amount, category, description, date);
            }

            document.getElementById('expense-form').reset();
            setTodayDate();
            document.querySelector('.btn').textContent = 'Add Expense';
            isEditing = false;
            expenseToEditId = null;
        }

        function addExpense(amount, category, description, date) {
            // WHY: Adds a new expense object.
            const newExpense = {
                id: Date.now(),
                amount: amount,
                category: category,
                description: description,
                date: date
            };
            
            expenses.push(newExpense);
            saveData();
            updateDashboard();
        }

        function deleteExpense(id) {
            // WHY: Filters out the expense with the matching ID.
            expenses = expenses.filter(exp => exp.id !== id);
            saveData();
            updateDashboard();
        }
        
        function startEditExpense(id) {
            // WHY: Prepares the form for editing the selected expense.
            const expense = expenses.find(exp => exp.id === id);
            if (!expense) return;

            document.getElementById('amount').value = expense.amount;
            document.getElementById('category').value = expense.category;
            document.getElementById('description').value = expense.description;
            document.getElementById('date').value = expense.date;

            isEditing = true;
            expenseToEditId = id;
            document.querySelector('.btn').textContent = 'Update Expense';

            document.getElementById('expense-form').scrollIntoView({ behavior: 'smooth' });
        }

        function updateExpense(id, amount, category, description, date) {
            // WHY: Updates the expense object in the main array.
            expenses = expenses.map(exp => {
                if (exp.id === id) {
                    return { id, amount, category, description, date }; 
                }
                return exp;
            });
            saveData();
            updateDashboard();
            alert('‚úÖ Expense updated successfully!');
        }


        // ----------------------------------------------------------------------
        // Budget Handling
        // ----------------------------------------------------------------------

        function setBudget(e) {
            // WHY: Stores category-specific or overall budget limits.
            e.preventDefault();
            
            const category = document.getElementById('budget-category').value;
            const amount = parseFloat(document.getElementById('budget-amount').value);
            
            budgets[category] = amount;
            saveData();
            updateDashboard();
            document.getElementById('budget-form').reset();
            const name = category === 'total' ? 'Overall' : categories[category].name;
            alert(`üéØ Budget set for ${name}: ‚Çπ${amount.toLocaleString()}`);
        }


        // ----------------------------------------------------------------------
        // Dashboard Rendering
        // ----------------------------------------------------------------------

        function updateDashboard() {
            // WHY: Main function to refresh all display components.
            updateStats();
            updateRecentTransactions();
            updateCharts();
            updateCategoriesOverview(); 
            updateAIInsights();
        }

        function updateRecentTransactions() {
            // WHY: Renders the list of recent transactions with Edit/Delete buttons.
            const container = document.getElementById('recent-transactions');
            container.innerHTML = '';
            
            const recentExpenses = expenses.slice(-10).reverse();
            
            recentExpenses.forEach(expense => {
                const category = categories[expense.category] || { name: 'Unknown', icon: '‚ùì', color: '#778899' }; // Safeguard for old categories
                const item = document.createElement('div');
                item.className = 'expense-item';
                item.innerHTML = `
                    <div style="flex: 1;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <span style="font-size: 1.5rem;">${category.icon}</span>
                            <div>
                                <div style="font-weight: bold;">${expense.description}</div>
                                <div style="font-size: 0.9rem; color: #ccc;">${category.name} ‚Ä¢ ${expense.date}</div>
                            </div>
                        </div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: bold;">‚Çπ${expense.amount.toLocaleString()}</span>
                        <button class="delete-btn" onclick="startEditExpense(${expense.id})">‚úèÔ∏è</button>
                        <button class="delete-btn" onclick="deleteExpense(${expense.id})">üóëÔ∏è</button>
                    </div>
                `;
                container.appendChild(item);
            });
        }


        // ----------------------------------------------------------------------
        // AI Insights & Monthly Reporting (Enhanced Logic)
        // ----------------------------------------------------------------------

        function getMonthlyTotals(monthYear) {
            // WHY: Helper function to calculate total spending and category spending for a specific month.
            const totals = { total: 0 };
            expenses.filter(exp => exp.date.startsWith(monthYear)).forEach(exp => {
                totals.total += exp.amount;
                totals[exp.category] = (totals[exp.category] || 0) + exp.amount;
            });
            return totals;
        };

        function getMonthName(monthYear) {
            // WHY: Converts 'YYYY-MM' format to readable month name (e.g., Nov 25)
            const [year, month] = monthYear.split('-');
            const date = new Date(year, month - 1, 1);
            return date.toLocaleString('default', { month: 'short', year: '2-digit' });
        }


        function updateAIInsights() {
            const container = document.getElementById('ai-insights');
            const insights = [];

            const today = new Date();
            const currentMonthYear = today.toISOString().slice(0, 7); 
            
            // Calculate Previous Month's data (for reporting)
            const previousDate = new Date();
            previousDate.setMonth(today.getMonth() - 1);
            const previousMonthYear = previousDate.toISOString().slice(0, 7);
            const previousTotals = getMonthlyTotals(previousMonthYear);
            
            // Calculate Current Month's data (for real-time alerts)
            const currentTotals = getMonthlyTotals(currentMonthYear);
            const currentTotalExpenses = currentTotals.total;

            if (currentTotalExpenses === 0 && previousTotals.total === 0) {
                container.innerHTML = `<div class="insight-item"><p style="color: #4ecdc4;">Start adding expenses and set budgets to get AI insights! üöÄ</p></div>`;
                return;
            }
            
            // --- 1. Month-by-Month Reporting (If previous month is complete) ---
            if (previousTotals.total > 0 && today.getDate() > 5) { // Check if previous month has data and current month has started significantly
                let reportMessage = `‚úÖ **${getMonthName(previousMonthYear)}** Report: `;
                let overspentCount = 0;
                
                Object.keys(budgets).forEach(key => {
                    const budgetAmount = budgets[key];
                    if (budgetAmount <= 0) return;

                    const spentAmount = key === 'total' ? previousTotals.total : previousTotals[key] || 0;
                    const percentageUsed = (spentAmount / budgetAmount) * 100;
                    
                    if (percentageUsed > 100) {
                        overspentCount++;
                    }
                });

                if (overspentCount === 0) {
                     reportMessage += `Aapne **sabhi budgets** manage kiye! Shandar performance! üëè`;
                } else if (overspentCount > 0 && overspentCount <= 2) {
                    reportMessage += `${overspentCount} categories mein budget **thoda sa exceed** hua. Overall control accha hai! üëç`;
                } else {
                    reportMessage += `Budget **${overspentCount}** categories mein fail hua. Agle mahine planning badalne ki zaroorat hai. üìâ`;
                }

                insights.push({
                    message: reportMessage,
                    color: overspentCount === 0 ? '#4ecdc4' : (overspentCount <= 2 ? '#ffeaa7' : '#ff6b6b')
                });

                // Add Total Spending Trend Insight (re-used logic)
                 if (previousTotals.total > 0 && currentTotals.total > 0) {
                    const change = currentTotals.total - previousTotals.total;
                    const percentageChange = (change / previousTotals.total) * 100;
                    
                    if (Math.abs(percentageChange) >= 20) {
                        const trend = change > 0 ? 'badh gaye' : 'kam ho gaye';
                        const color = change > 0 ? '#ff6b6b' : '#4ecdc4';
                        const icon = change > 0 ? 'üî∫' : '‚úÖ';

                        insights.push({
                            message: `${icon} Total spending **${getMonthName(currentMonthYear)}** mein **${Math.abs(percentageChange).toFixed(1)}% ${trend}** hai!`,
                            color: color
                        });
                    }
                }
            }
            
            
            // --- 2. Real-time Budget Alerts (Current Month) ---
            Object.keys(budgets).forEach(key => {
                const budgetAmount = budgets[key];
                if (budgetAmount <= 0) return;
                
                const categoryInfo = categories[key];
                
                if (key !== 'total' && !categoryInfo) {
                    return; 
                } 
                
                const spentAmount = key === 'total' ? currentTotalExpenses : currentTotals[key] || 0;
                const percentageUsed = (spentAmount / budgetAmount) * 100;
                const name = key === 'total' ? 'Overall Budget' : categoryInfo.name;

                if (percentageUsed >= 100) {
                    const overspent = spentAmount - budgetAmount;
                    insights.push({
                        message: `‚ö†Ô∏è Alert! ${name} **${overspent.toLocaleString()}‚Çπ se exceed** ho chuka hai. üõë`,
                        color: '#ff6b6b'
                    });
                } else if (percentageUsed >= 75) {
                     insights.push({
                        message: `üü° ${name} **${percentageUsed.toFixed(0)}%** use ho chuka hai. Mahina khatam hone se pehle dhyan dein! üëÄ`,
                        color: '#ffeaa7'
                    });
                }
            });


            // --- 3. Fallback Insight ---
            if (insights.length === 0) {
                insights.push({
                    message: 'Waah! Aapka spending pattern balanced lag raha hai aur koi alert nahi hai! Keep it up! üéâ',
                    color: '#4ecdc4'
                });
            }
            
            container.innerHTML = insights.map(insight => `
                <div class="insight-item">
                    <p style="color: ${insight.color}; font-weight: bold;">${insight.message}</p>
                </div>
            `).join('');
        }

        // ----------------------------------------------------------------------
        // Other Functions (Charts, Stats, etc.)
        // ----------------------------------------------------------------------

        function setTodayDate() {
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }
        
        function updateStats() {
            const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const totalTransactions = expenses.length;
            const activeCategories = new Set(expenses.map(exp => exp.category)).size;
            
            document.getElementById('total-expenses').textContent = `‚Çπ${totalExpenses.toLocaleString()}`;
            document.getElementById('total-transactions').textContent = totalTransactions;
            document.getElementById('active-categories').textContent = activeCategories;
        }


        function initCharts() {
             const pieCtx = document.getElementById('pie-chart').getContext('2d');
             const lineCtx = document.getElementById('line-chart').getContext('2d');
            
             Chart.defaults.font.family = "'Exo 2', sans-serif";
             Chart.defaults.color = '#fff';
            
             pieChart = new Chart(pieCtx, {
                 type: 'pie',
                 data: { labels: [], datasets: [{ data: [], backgroundColor: [], borderWidth: 2, borderColor: 'rgba(255, 255, 255, 0.2)' }] },
                 options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: 'white' } } } }
             });
            
             lineChart = new Chart(lineCtx, {
                 type: 'line',
                 data: {
                     labels: [],
                     datasets: [{
                         label: 'Monthly Expenses',
                         data: [],
                         borderColor: '#4ECDC4',
                         backgroundColor: 'rgba(78, 205, 196, 0.1)',
                         borderWidth: 3,
                         fill: true,
                         tension: 0.4
                     }]
                 },
                 options: {
                     responsive: true,
                     maintainAspectRatio: false,
                     plugins: { legend: { labels: { color: 'white' } } },
                     scales: {
                         x: { ticks: { color: 'white' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } },
                         y: { ticks: { color: 'white' }, grid: { color: 'rgba(255, 255, 255, 0.1)' } }
                     }
                 }
             });
         }

         function updateCharts() {
             const categoryData = {};
             expenses.forEach(expense => {
                 categoryData[expense.category] = (categoryData[expense.category] || 0) + expense.amount;
             });
            
             const pieLabels = Object.keys(categoryData).map(catId => categories[catId] ? categories[catId].name : catId);
             const pieData = Object.values(categoryData);
             const pieColors = Object.keys(categoryData).map(catId => categories[catId] ? categories[catId].color : '#778899');
            
             pieChart.data.labels = pieLabels;
             pieChart.data.datasets[0].data = pieData;
             pieChart.data.datasets[0].backgroundColor = pieColors;
             pieChart.update();
            
             const monthlyData = {};
             expenses.forEach(expense => {
                 const month = new Date(expense.date).toLocaleString('default', { month: 'short', year: '2-digit' });
                 monthlyData[month] = (monthlyData[month] || 0) + expense.amount;
             });
            
             const lineLabels = Object.keys(monthlyData).sort();
             const lineData = lineLabels.map(month => monthlyData[month]);
            
             lineChart.data.labels = lineLabels;
             lineChart.data.datasets[0].data = lineData;
             lineChart.update();
         }

        function updateCategoriesOverview() {
            const container = document.getElementById('categories-overview');
            const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const categoryTotals = {};
            
            expenses.forEach(expense => {
                categoryTotals[expense.category] = (categoryTotals[expense.category] || 0) + expense.amount;
            });
            
            container.innerHTML = Object.keys(categories).map(catId => {
                const category = categories[catId];
                const amount = categoryTotals[catId] || 0;
                const percentage = totalExpenses > 0 ? (amount / totalExpenses) * 100 : 0;
                
                return `
                    <div class="category-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <span style="font-size: 1.5rem;">${category.icon}</span>
                                <span style="font-weight: bold;">${category.name}</span>
                            </div>
                            <span style="font-weight: bold;">‚Çπ${amount.toLocaleString()}</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${Math.min(percentage, 100)}%; background-color: ${category.color};"></div>
                        </div>
                        <p style="color: #ccc; font-size: 0.9rem;">${percentage.toFixed(1)}% of total</p>
                    </div>
                `;
            }).join('');
        }

        function exportData() {
            const dataToExport = {
                expenses: expenses,
                budgets: budgets
            };
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `finance_data_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            URL.revokeObjectURL(url);
            
            alert('üìä Data exported successfully!');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (importedData && Array.isArray(importedData.expenses)) {
                        expenses = importedData.expenses;
                        budgets = importedData.budgets || {};
                        saveData();
                        updateDashboard();
                        alert('üìÅ Data imported successfully!');
                    } else {
                        alert('‚ùå Invalid file format or missing data structure!');
                    }
                } catch (error) {
                    alert('‚ùå Error reading file!');
                }
            };
            reader.readAsText(file);
        }

    </script>
</body>
</html>
